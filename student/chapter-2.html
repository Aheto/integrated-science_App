<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Discuss the importance of specific solids to life">
  <title>Mini OpenStax ‚Äî Discuss the importance of specific solids to life</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Discuss the importance of specific solids to life</h1>
        <div class="lo-tags" id="lo-tags">B7/JHS1.1.1.1.3</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <!-- === REPLACE THIS SECTION PER LESSON === -->
      <div class="section">
        <h2>üéØ What You‚Äôll Learn</h2>
        <ul id="objectives">
          <li>Identify solids in your environment that support human and animal survival.</li>
          <li>Explain why preserving useful solid materials (like soil, wood, and minerals) is essential for life.</li>
          <li>Model or describe how solids are used to build shelters, tools, and infrastructure.</li>
          <li>Reflect on sustainable practices to protect solid resources in Ghana.</li>
        </ul>
      </div>

      <div class="section">
        <h2>üî§ Important Words</h2>
        <p id="word-list-desc">Key terms for this lesson:</p>
        <div class="word-list" id="word-list">
          <span class="word-item">Soil</span>
          <span class="word-item">Mineral</span>
          <span class="word-item">Wood</span>
          <span class="word-item">Rock</span>
          <span class="word-item">Metal</span>
          <span class="word-item">Infrastructure</span>
          <span class="word-item">Preservation</span>
          <span class="word-item">Sustainable</span>
        </div>
      </div>

      <div class="section" id="lesson-content">
        <h2>üìò Why Solids Are Essential to Life</h2>
        <p>Solids are not just ‚Äúhard things‚Äù‚Äîthey form the foundation of life on Earth. From the ground we walk on to the buildings we live in, solids provide structure, nutrients, and resources for survival.</p>

        <h3>üåç Soil: The Living Solid</h3>
        <ul>
          <li>Supports plant growth ‚Üí food for humans and animals.</li>
          <li>Contains water, minerals, and microorganisms.</li>
          <li>Erosion (washing away of soil) reduces farm productivity.</li>
        </ul>

        <h3>ü™µ Wood & Plants</h3>
        <ul>
          <li>Used for building houses, furniture, and fuel (charcoal).</li>
          <li>Forests regulate climate and prevent flooding.</li>
          <li>Deforestation leads to desertification and loss of habitat.</li>
        </ul>

        <h3>ü™® Rocks and Minerals</h3>
        <ul>
          <li><strong>Granite, sandstone, laterite</strong>: Used in construction.</li>
          <li><strong>Gold, bauxite, manganese</strong>: Mined for industry and export.</li>
          <li><strong>Clay</strong>: Used to make pots, bricks, and tiles.</li>
        </ul>

        <h3>üî© Metals</h3>
        <ul>
          <li><strong>Iron, aluminum, copper</strong>: Used in tools, wires, vehicles.</li>
          <li>Recycling metals saves energy and reduces mining damage.</li>
        </ul>

        <blockquote>
          üí≠ <strong>Thought Experiment</strong>: Imagine your village has no soil, no trees, and no rocks. Could people still live there? What would be missing?
        </blockquote>

        <h3>‚úÖ Exemplar Activity: Observe & Model</h3>
        <p>Walk around your community and list 5 solids that support life. Then, sketch or build a simple model (e.g., a clay pot, a wooden stool, a stone wall) to show how one solid is useful.</p>

        <table>
          <thead>
            <tr><th>Solid</th><th>Used For</th><th>Why It‚Äôs Important</th></tr>
          </thead>
          <tbody>
            <tr><td>Laterite soil</td><td>Building walls</td><td>Provides shelter from rain and sun</td></tr>
            <tr><td>Wood</td><td>Cooking fuel</td><td>Enables food preparation</td></tr>
            <tr><td>Clay</td><td>Making pots</td><td>Stores water and cooks food</td></tr>
          </tbody>
        </table>

        <h3>‚ö†Ô∏è Threats to Solid Resources</h3>
        <ul>
          <li><strong>Illegal mining (galamsey)</strong>: Destroys farmland and pollutes rivers.</li>
          <li><strong>Deforestation</strong>: Removes tree cover, causing soil erosion.</li>
          <li><strong>Overharvesting clay or sand</strong>: Depletes local building materials.</li>
        </ul>

        <h3>‚ôªÔ∏è How to Preserve Solids</h3>
        <ul>
          <li>Plant trees to hold soil in place.</li>
          <li>Use alternative fuels (e.g., LPG) to reduce wood cutting.</li>
          <li>Recycle metal cans and electronics.</li>
          <li>Support laws against illegal mining.</li>
        </ul>
      </div>

      <div class="section">
        <h2>‚úÖ Check Your Understanding</h2>
        <div class="checkpoint" id="checkpoint-questions">
          <ol>
            <li>Name three solids in your environment that help humans survive.</li>
            <li>How does soil support life beyond just growing plants?</li>
            <li>Why is illegal mining harmful to solid resources?</li>
            <li>Design a simple object made from a solid material that solves a daily problem (e.g., a clay water filter).</li>
          </ol>
          <p><em>Confirm your understanding before moving on.</em></p>
        </div>
      </div>

      <div class="section" id="next-preview">
        <h3>üîú Coming Up</h3>
        <p>In Lesson 4, we‚Äôll explore how heating and cooling change materials‚Äîlike ice melting or water boiling‚Äîand why these changes matter in cooking, weather, and technology.</p>
      </div>
      <!-- === END REPLACE SECTION === -->

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>

      <!-- FOOTER -->
      <footer>
        <a href="../premium.html" style="display:block; margin-bottom:0.5rem;">‚ú® Unlock Premium Features</a>
        <a href="#" id="send-analytics" style="color:#6c757d;">üì§ Send Anonymous Usage Data</a>
        <br>
        <a href="../dashboard.html">üìä View Dashboard</a>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const currentChapter = 2;
      const MAX_CHAPTER = 300;
      const WHATSAPP_NUMBER = "233257320201";

      const ANALYTICS_KEY = 'miniopenstax_analytics_consent';
      const EVENTS_KEY = 'miniopenstax_events';

      function isAnalyticsEnabled() {
        return localStorage.getItem(ANALYTICS_KEY) === '1';
      }

      function logEvent(eventType, data = {}) {
        if (!isAnalyticsEnabled()) return;
        const event = { type: eventType, timestamp: Date.now(), lesson: currentChapter, data };
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        events.push(event);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        if (events.length >= 20) sendAnalyticsEvents();
      }

      function enableAnalytics() {
        localStorage.setItem(ANALYTICS_KEY, '1');
      }

      function sendAnalyticsEvents() {
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        if (events.length === 0) return;
        const summary = {
          lessons_attempted: [...new Set(events.map(e => e.lesson))].length,
          quizzes_submitted: events.filter(e => e.type === 'quiz_submitted').length,
          mastery_count: events.filter(e => e.type === 'mastery_achieved').length,
          first_event: new Date(events[0].timestamp).toISOString().split('T')[0],
          last_event: new Date(events[events.length - 1].timestamp).toISOString().split('T')[0]
        };
        const report = `*Mini OpenStax ‚Äî Anonymous Usage Report*\n` +
          `Lessons Tried: ${summary.lessons_attempted}\n` +
          `Quizzes Taken: ${summary.quizzes_submitted}\n` +
          `Mastery Achieved: ${summary.mastery_count}\n` +
          `Period: ${summary.first_event} to ${summary.last_event}\n\n` +
          `Thank you for helping improve literacy tools!`;
        localStorage.removeItem(EVENTS_KEY);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        window.open(url, '_blank');
      }

      const CHAPTER_CONFIG = {
        title: "Discuss the importance of specific solids to life",
        loTags: ["B7/JHS1.1.1.1.3"],
        objectives: [
          "Identify solids in your environment that support human and animal survival.",
          "Explain why preserving useful solid materials (like soil, wood, and minerals) is essential for life.",
          "Model or describe how solids are used to build shelters, tools, and infrastructure.",
          "Reflect on sustainable practices to protect solid resources in Ghana."
        ],
        words: [
          "Soil", "Mineral", "Wood", "Rock",
          "Metal", "Infrastructure", "Preservation", "Sustainable"
        ],
        wordListDesc: "Key terms for this lesson:",
        checkpointQuestions: `
          <ol>
            <li>Name three solids in your environment that help humans survive.</li>
            <li>How does soil support life beyond just growing plants?</li>
            <li>Why is illegal mining harmful to solid resources?</li>
            <li>Design a simple object made from a solid material that solves a daily problem (e.g., a clay water filter).</li>
          </ol>
          <p><em>Confirm your understanding before moving on.</em></p>
        `,
        nextPreview: "In Lesson 4, we‚Äôll explore how heating and cooling change materials‚Äîlike ice melting or water boiling‚Äîand why these changes matter in cooking, weather, and technology.",
        assessmentItems: [
          { id: "1", prompt: "Which solid is most essential for growing food?", options: [
            {id:"a",text:"Plastic",is_correct:false},
            {id:"b",text:"Soil",is_correct:true},
            {id:"c",text:"Glass",is_correct:false},
            {id:"d",text:"Rubber",is_correct:false}
          ]},
          { id: "2", prompt: "What is a major effect of deforestation in Ghana?", options: [
            {id:"a",text:"More rainfall",is_correct:false},
            {id:"b",text:"Soil erosion and loss of habitat",is_correct:true},
            {id:"c",text:"Increased fish supply",is_correct:false},
            {id:"d",text:"Better air conditioning",is_correct:false}
          ]},
          { id: "3", prompt: "Which solid is commonly used to make cooking pots in rural Ghana?", options: [
            {id:"a",text:"Clay",is_correct:true},
            {id:"b",text:"Paper",is_correct:false},
            {id:"c",text:"Foam",is_correct:false},
            {id:"d",text:"Wax",is_correct:false}
          ]},
          { id: "4", prompt: "Why is laterite soil useful?", options: [
            {id:"a",text:"It dissolves in rain",is_correct:false},
            {id:"b",text:"It is soft and powdery",is_correct:false},
            {id:"c",text:"It hardens when dry and is used for building",is_correct:true},
            {id:"d",text:"It glows at night",is_correct:false}
          ]},
          { id: "5", prompt: "Which activity harms solid resources like soil and rock?", options: [
            {id:"a",text:"Tree planting",is_correct:false},
            {id:"b",text:"Illegal mining (galamsey)",is_correct:true},
            {id:"c",text:"Composting",is_correct:false},
            {id:"d",text:"Recycling paper",is_correct:false}
          ]},
          { id: "6", prompt: "What is one way to preserve wood resources?", options: [
            {id:"a",text:"Cut down all trees quickly",is_correct:false},
            {id:"b",text:"Use LPG instead of firewood for cooking",is_correct:true},
            {id:"c",text:"Burn forest waste openly",is_correct:false},
            {id:"d",text:"Leave farmland bare",is_correct:false}
          ]},
          { id: "7", prompt: "Which solid provides minerals for plant growth?", options: [
            {id:"a",text:"Soil",is_correct:true},
            {id:"b",text:"Air",is_correct:false},
            {id:"c",text:"Water vapour",is_correct:false},
            {id:"d",text:"Steam",is_correct:false}
          ]},
          { id: "8", prompt: "Metals like iron and aluminum are important because they:", options: [
            {id:"a",text:"Evaporate easily",is_correct:false},
            {id:"b",text:"Are used to make tools, vehicles, and wires",is_correct:true},
            {id:"c",text:"Melt at room temperature",is_correct:false},
            {id:"d",text:"Are gases at high heat",is_correct:false}
          ]},
          { id: "9", prompt: "What is 'sustainable use' of solids?", options: [
            {id:"a",text:"Using as much as possible now",is_correct:false},
            {id:"b",text:"Using resources in a way that does not deplete them for future generations",is_correct:true},
            {id:"c",text:"Ignoring environmental laws",is_correct:false},
            {id:"d",text:"Mining without permits",is_correct:false}
          ]},
          { id: "10", prompt: "Which solid is mined in Ghana for export and industry?", options: [
            {id:"a",text:"Gold",is_correct:true},
            {id:"b",text:"Ice",is_correct:false},
            {id:"c",text:"Juice",is_correct:false},
            {id:"d",text:"Smoke",is_correct:false}
          ]},
          { id: "11", prompt: "How do trees help preserve soil?", options: [
            {id:"a",text:"Their roots hold soil in place",is_correct:true},
            {id:"b",text:"They absorb all water",is_correct:false},
            {id:"c",text:"They turn soil into gas",is_correct:false},
            {id:"d",text:"They make soil disappear",is_correct:false}
          ]},
          { id: "12", prompt: "Which of these is NOT a solid?", options: [
            {id:"a",text:"Rock",is_correct:false},
            {id:"b",text:"Sand",is_correct:false},
            {id:"c",text:"Water",is_correct:true},
            {id:"d",text:"Brick",is_correct:false}
          ]},
          { id: "13", prompt: "Why is clay valuable in Ghanaian communities?", options: [
            {id:"a",text:"It is used only for decoration",is_correct:false},
            {id:"b",text:"It can be shaped into useful items like pots and bricks",is_correct:true},
            {id:"c",text:"It melts in sunlight",is_correct:false},
            {id:"d",text:"It repels rain",is_correct:false}
          ]},
          { id: "14", prompt: "What happens when topsoil is washed away?", options: [
            {id:"a",text:"Farms become more fertile",is_correct:false},
            {id:"b",text:"Crop yields decrease",is_correct:true},
            {id:"c",text:"Trees grow faster",is_correct:false},
            {id:"d",text:"Rivers dry up immediately",is_correct:false}
          ]},
          { id: "15", prompt: "Which action helps preserve solid resources?", options: [
            {id:"a",text:"Dumping waste on farmland",is_correct:false},
            {id:"b",text:"Recycling metal cans",is_correct:true},
            {id:"c",text:"Burning plastic openly",is_correct:false},
            {id:"d",text:"Overgrazing land",is_correct:false}
          ]},
          { id: "16", prompt: "What role do rocks play in construction?", options: [
            {id:"a",text:"They are too soft to use",is_correct:false},
            {id:"b",text:"They provide strong, durable material for buildings and roads",is_correct:true},
            {id:"c",text:"They evaporate in heat",is_correct:false},
            {id:"d",text:"They are only for decoration",is_correct:false}
          ]},
          { id: "17", prompt: "Which solid supports animal life by providing habitat?", options: [
            {id:"a",text:"Soil and forests",is_correct:true},
            {id:"b",text:"Smoke",is_correct:false},
            {id:"c",text:"Steam",is_correct:false},
            {id:"d",text:"Oil",is_correct:false}
          ]},
          { id: "18", prompt: "Why should we avoid overharvesting sand?", options: [
            {id:"a",text:"Sand is unlimited",is_correct:false},
            {id:"b",text:"It leads to riverbank collapse and loss of building material",is_correct:true},
            {id:"c",text:"Sand turns into water",is_correct:false},
            {id:"d",text:"It improves fishing",is_correct:false}
          ]},
          { id: "19", prompt: "Which statement best describes the importance of solids to life?", options: [
            {id:"a",text:"Solids are only for building houses",is_correct:false},
            {id:"b",text:"Solids provide food, shelter, tools, and habitat‚Äîessential for survival",is_correct:true},
            {id:"c",text:"Only liquids and gases matter",is_correct:false},
            {id:"d",text:"Solids are unimportant in modern life",is_correct:false}
          ]},
          { id: "20", prompt: "What is one creative way to reuse solid waste?", options: [
            {id:"a",text:"Burn all plastic",is_correct:false},
            {id:"b",text:"Turn old tires into garden planters",is_correct:true},
            {id:"c",text:"Throw metals in rivers",is_correct:false},
            {id:"d",text:"Bury electronics in soil",is_correct:false}
          ]}
        ]
      };

      function renderContent() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];

        document.getElementById('objectives').innerHTML =
          CHAPTER_CONFIG.objectives.map(obj => `<li>${obj}</li>`).join('');

        document.getElementById('word-list-desc').textContent = CHAPTER_CONFIG.wordListDesc;
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.words.map(w => `<span class="word-item">${w}</span>`).join('');

        document.getElementById('checkpoint-questions').innerHTML = CHAPTER_CONFIG.checkpointQuestions;

        document.getElementById('next-preview').innerHTML = `
          <h3>üîú Coming Up</h3>
          <p>${CHAPTER_CONFIG.nextPreview}</p>
        `;
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        logEvent('quiz_submitted', { score, time_sec: timeOnTask, mastery, attempts });
        if (mastery) logEvent('mastery_achieved', {});

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const savedRole = localStorage.getItem('user_role') || 'student';
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        const roleBadge = document.querySelector('.role-badge');
        roleBadge.textContent = savedRole === 'instructor' ? 'Instructor View' : 'Student View';

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved} (${savedRole})</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
            logEvent('lesson_start', {});
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `
              <button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>
              <div style="margin-top:1rem; font-size:0.9rem;">
                <label>
                  <input type="checkbox" id="teacher-mode"> 
                  I'm an instructor (analytics auto-enabled to improve lessons)
                </label>
              </div>
            `;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                const isTeacher = document.getElementById('teacher-mode').checked;
                localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
                if (isTeacher) enableAnalytics();
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
                roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
                logEvent('lesson_start', {});
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `
            <button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>
            <div style="margin-top:1rem; font-size:0.9rem;">
              <label>
                <input type="checkbox" id="teacher-mode"> 
                I'm an instructor (analytics auto-enabled to improve lessons)
              </label>
            </div>
          `;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              const isTeacher = document.getElementById('teacher-mode').checked;
              localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
              if (isTeacher) enableAnalytics();
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
              roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
              logEvent('lesson_start', {});
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        renderContent();
        renderNavigation();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('send-analytics').onclick = (e) => {
          e.preventDefault();
          if (confirm('Send anonymous usage data to help improve Mini OpenStax?')) {
            sendAnalyticsEvents();
          }
        };
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
