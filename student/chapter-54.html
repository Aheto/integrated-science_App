<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Food Nutrients and Their Functions">
  <title>Mini OpenStax ‚Äî Food Nutrients and Their Functions</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
    .activity-card, .review-card, .nutrient-box, .waste-box, .tool-box, .friction-box, .machine-box, .concept-box, .law-box, .energy-box, .component-box {
      background: #f8f9fa;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 6px;
      border-left: 4px solid var(--green);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Food Nutrients and Their Functions</h1>
        <div class="lo-tags" id="lo-tags">B7/JHS1.5.1.1</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üéØ What You‚Äôll Learn</h2>
        <ul id="objectives">
          <!-- Auto-filled -->
        </ul>
      </div>

      <div class="section">
        <h2>üî§ Important Words</h2>
        <p id="word-list-desc">Key terms for this lesson:</p>
        <div class="word-list" id="word-list">
          <!-- Auto-filled -->
        </div>
      </div>

      <div class="section" id="lesson-content">
        <h2>üìò Why Your Body Needs Different Foods</h2>
        <p>Your body is like a high-performance machine‚Äîit needs the right fuel to grow, move, think, and stay healthy. The foods you eat provide <strong>nutrients</strong>, which are substances your body uses for energy, repair, and protection.</p>

        <table>
          <thead>
            <tr>
              <th>Nutrient</th>
              <th>Main Function</th>
              <th>Local Food Sources (Ghana)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td><strong>Carbohydrates</strong></td><td>Provide quick energy</td><td>Rice, yam, cassava, plantain, maize</td></tr>
            <tr><td><strong>Proteins</strong></td><td>Build and repair muscles, skin, blood</td><td>Beans, groundnuts, fish, eggs, meat, milk</td></tr>
            <tr><td><strong>Fats & Oils</strong></td><td>Store energy, protect organs</td><td>Palm oil, groundnut oil, avocado, coconut</td></tr>
            <tr><td><strong>Vitamins</strong></td><td>Support immunity, vision, healing</td><td>Kontomire, oranges, mangoes, tomatoes</td></tr>
            <tr><td><strong>Minerals</strong></td><td>Build strong bones, carry oxygen</td><td>Leafy greens (iron), dairy/fish (calcium)</td></tr>
            <tr><td><strong>Water</strong></td><td>Carry nutrients, regulate temperature</td><td>Water, soups, fruits like watermelon</td></tr>
          </tbody>
        </table>

        <blockquote>
          üí≠ <strong>Thought Experiment</strong>: Imagine your body is a smartphone. Carbs are like the battery (energy), proteins are the software updates (repair), and vitamins are the antivirus (protection). What happens if you only charge it but never update or scan for viruses?
        </blockquote>

        <div class="activity-card">
          <h3>‚úÖ Exemplar Activity</h3>
          <p><strong>‚ÄúMy Plate Audit‚Äù</strong>: For one day, write down everything you eat. Then, using the table above, color-code each food by its main nutrient (e.g., red for protein, yellow for carbs). Did your plate include all six nutrients? If not, what local foods could you add tomorrow?</p>
        </div>
      </div>

      <div class="section">
        <h2>‚úÖ Check Your Understanding</h2>
        <div class="checkpoint" id="checkpoint-questions">
          <!-- Auto-filled -->
        </div>
      </div>

      <div class="section" id="next-preview">
        <h3>üîú Coming Up</h3>
        <p>In Lesson 55, you‚Äôll discover what happens when your body lacks key nutrients‚Äîand how diseases like kwashiorkor, anemia, and scurvy develop. You‚Äôll also learn how Ghanaian foods can prevent these conditions!</p>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>

      <footer>
        <a href="../premium.html" style="display:block; margin-bottom:0.5rem;">‚ú® Unlock Premium Features</a>
        <a href="#" id="send-analytics" style="color:#6c757d;">üì§ Send Anonymous Usage Data</a>
        <br>
        <a href="../dashboard.html">üìä View Dashboard</a>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      const currentChapter = 54;
      const MAX_CHAPTER = 300;
      const WHATSAPP_NUMBER = "233257320201";

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const ANALYTICS_KEY = 'miniopenstax_analytics_consent';
      const EVENTS_KEY = 'miniopenstax_events';

      function isAnalyticsEnabled() {
        return localStorage.getItem(ANALYTICS_KEY) === '1';
      }

      function logEvent(eventType, data = {}) {
        if (!isAnalyticsEnabled()) return;
        const event = { type: eventType, timestamp: Date.now(), lesson: currentChapter, data };
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        events.push(event);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        if (events.length >= 20) sendAnalyticsEvents();
      }

      function enableAnalytics() {
        localStorage.setItem(ANALYTICS_KEY, '1');
      }

      function sendAnalyticsEvents() {
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        if (events.length === 0) return;
        const summary = {
          lessons_attempted: [...new Set(events.map(e => e.lesson))].length,
          quizzes_submitted: events.filter(e => e.type === 'quiz_submitted').length,
          mastery_count: events.filter(e => e.type === 'mastery_achieved').length,
          first_event: new Date(events[0].timestamp).toISOString().split('T')[0],
          last_event: new Date(events[events.length - 1].timestamp).toISOString().split('T')[0]
        };
        const report = `*Mini OpenStax ‚Äî Anonymous Usage Report*\n` +
          `Lessons Tried: ${summary.lessons_attempted}\n` +
          `Quizzes Taken: ${summary.quizzes_submitted}\n` +
          `Mastery Achieved: ${summary.mastery_count}\n` +
          `Period: ${summary.first_event} to ${summary.last_event}\n\n` +
          `Thank you for helping improve literacy tools!`;
        localStorage.removeItem(EVENTS_KEY);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        window.open(url, '_blank');
      }

      const LESSON_DATABASE = {
        54: {
          title: "Food Nutrients and Their Functions",
          loTags: ["B7/JHS1.5.1.1"],
          objectives: [
            "Identify the six major types of nutrients in food.",
            "Explain the primary function of each nutrient in the human body.",
            "Match common Ghanaian foods to their dominant nutrient groups.",
            "Begin evaluating personal diets for balance and variety."
          ],
          words: ["Nutrient", "Carbohydrate", "Protein", "Fat", "Vitamin", "Mineral", "Water", "Function", "Source", "Balanced diet"],
          wordListDesc: "Key terms for this lesson:",
          checkpointQuestions: `
            <ol>
              <li>Name the nutrient that gives you immediate energy. Give two local examples.</li>
              <li>Why does your body need protein every day?</li>
              <li>Is palm oil a source of fat or carbohydrate? Why is it useful?</li>
              <li>If you only ate kenkey and fish every day, which nutrients might you be missing?</li>
            </ol>
            <p><em>Confirm your understanding before exploring deficiency diseases!</em></p>
          `,
          nextPreview: "In Lesson 55, you‚Äôll discover what happens when your body lacks key nutrients‚Äîand how diseases like kwashiorkor, anemia, and scurvy develop. You‚Äôll also learn how Ghanaian foods can prevent these conditions!",
          assessmentItems: [
            { id: "1", prompt: "Which nutrient provides the body‚Äôs main source of energy?", options: [{id:"a",text:"Protein",is_correct:false},{id:"b",text:"Carbohydrate",is_correct:true},{id:"c",text:"Vitamin",is_correct:false},{id:"d",text:"Mineral",is_correct:false}]},
            { id: "2", prompt: "What is the main function of protein?", options: [{id:"a",text:"Quick energy",is_correct:false},{id:"b",text:"Build and repair tissues",is_correct:true},{id:"c",text:"Store fat",is_correct:false},{id:"d",text:"Carry oxygen",is_correct:false}]},
            { id: "3", prompt: "Which food is rich in vitamin C?", options: [{id:"a",text:"Rice",is_correct:false},{id:"b",text:"Oranges",is_correct:true},{id:"c",text:"Palm oil",is_correct:false},{id:"d",text:"Yam",is_correct:false}]},
            { id: "4", prompt: "Kontomire is a good source of:", options: [{id:"a",text:"Iron and vitamins",is_correct:true},{id:"b",text:"Only carbohydrates",is_correct:false},{id:"c",text:"Sugar",is_correct:false},{id:"d",text:"Salt",is_correct:false}]},
            { id: "5", prompt: "Water is important because it:", options: [{id:"a",text:"Builds muscle",is_correct:false},{id:"b",text:"Transports nutrients and regulates temperature",is_correct:true},{id:"c",text:"Stores fat",is_correct:false},{id:"d",text:"Makes hair grow fast",is_correct:false}]},
            { id: "6", prompt: "Groundnuts provide mainly:", options: [{id:"a",text:"Carbs and sugar",is_correct:false},{id:"b",text:"Protein and healthy fats",is_correct:true},{id:"c",text:"Only water",is_correct:false},{id:"d",text:"Vitamin D",is_correct:false}]},
            { id: "7", prompt: "A balanced diet includes:", options: [{id:"a",text:"All six nutrient groups daily",is_correct:true},{id:"b",text:"Only rice and stew",is_correct:false},{id:"c",text:"Only snacks",is_correct:false},{id:"d",text:"Only drinks",is_correct:false}]},
            { id: "8", prompt: "Calcium is important for:", options: [{id:"a",text:"Energy",is_correct:false},{id:"b",text:"Strong bones and teeth",is_correct:true},{id:"c",text:"Hair color",is_correct:false},{id:"d",text:"Fast running",is_correct:false}]},
            { id: "9", prompt: "Fish is a good source of:", options: [{id:"a",text:"Protein and minerals",is_correct:true},{id:"b",text:"Only fat",is_correct:false},{id:"c",text:"Carbs",is_correct:false},{id:"d",text:"Sugar",is_correct:false}]},
            { id: "10", prompt: "Vitamins help with:", options: [{id:"a",text:"Immunity and healing",is_correct:true},{id:"b",text:"Making money",is_correct:false},{id:"c",text:"Sleeping longer",is_correct:false},{id:"d",text:"Growing taller instantly",is_correct:false}]},
            { id: "11", prompt: "Which is NOT a nutrient?", options: [{id:"a",text:"Fiber",is_correct:false},{id:"b",text:"Plastic",is_correct:true},{id:"c",text:"Minerals",is_correct:false},{id:"d",text:"Water",is_correct:false}]},
            { id: "12", prompt: "Palm oil contains:", options: [{id:"a",text:"Vitamin A and healthy fats",is_correct:true},{id:"b",text:"Only salt",is_correct:false},{id:"c",text:"Protein",is_correct:false},{id:"d",text:"Carbs",is_correct:false}]},
            { id: "13", prompt: "Eggs are rich in:", options: [{id:"a",text:"Protein and vitamins",is_correct:true},{id:"b",text:"Only water",is_correct:false},{id:"c",text:"Sugar",is_correct:false},{id:"d",text:"Fiber",is_correct:false}]},
            { id: "14", prompt: "Maize provides mainly:", options: [{id:"a",text:"Carbohydrates",is_correct:true},{id:"b",text:"Iron",is_correct:false},{id:"c",text:"Vitamin C",is_correct:false},{id:"d",text:"Calcium",is_correct:false}]},
            { id: "15", prompt: "Science shows that:", options: [{id:"a",text:"Local foods can meet all nutrient needs",is_correct:true},{id:"b",text:"Only imported foods are nutritious",is_correct:false},{id:"c",text:"Nutrition doesn‚Äôt affect health",is_correct:false},{id:"d",text:"Drinking soda replaces water",is_correct:false}]},
            { id: "16", prompt: "A student who eats only banku may lack:", options: [{id:"a",text:"Vitamins and protein",is_correct:true},{id:"b",text:"Too much fat",is_correct:false},{id:"c",text:"Excess sugar",is_correct:false},{id:"d",text:"Nothing‚Äîthey‚Äôre fine",is_correct:false}]},
            { id: "17", prompt: "The next lesson will cover:", options: [{id:"a",text:"Deficiency diseases like kwashiorkor and anemia",is_correct:true},{id:"b",text:"Electric circuits",is_correct:false},{id:"c",text:"Plant photosynthesis only",is_correct:false},{id:"d",text:"History of Ghana",is_correct:false}]},
            { id: "18", prompt: "Critical thinking in nutrition means:", options: [{id:"a",text:"Evaluating what you eat using science",is_correct:true},{id:"b",text:"Believing all ads",is_correct:false},{id:"c",text:"Never eating traditional food",is_correct:false},{id:"d",text:"Copying friends‚Äô diets",is_correct:false}]},
            { id: "19", prompt: "Digital literacy helps you:", options: [{id:"a",text:"Find reliable info about healthy eating",is_correct:true},{id:"b",text:"Play more games",is_correct:false},{id:"c",text:"Avoid school",is_correct:false},{id:"d",text:"Ignore science",is_correct:false}]},
            { id: "20", prompt: "This lesson shows that:", options: [{id:"a",text:"Nutrition is rooted in both science and culture",is_correct:true},{id:"b",text:"Food doesn‚Äôt matter",is_correct:false},{id:"c",text:"Only pills provide nutrients",is_correct:false},{id:"d",text:"Ghanaian foods are unhealthy",is_correct:false}]}
          ]
        }
      };

      const CHAPTER_CONFIG = LESSON_DATABASE[54];

      function renderContent() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];

        document.getElementById('objectives').innerHTML =
          CHAPTER_CONFIG.objectives.map(obj => `<li>${obj}</li>`).join('');

        document.getElementById('word-list-desc').textContent = CHAPTER_CONFIG.wordListDesc;
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.words.map(w => `<span class="word-item">${w}</span>`).join('');

        document.getElementById('checkpoint-questions').innerHTML = CHAPTER_CONFIG.checkpointQuestions;

        document.getElementById('next-preview').innerHTML = `
          <h3>üîú Coming Up</h3>
          <p>${CHAPTER_CONFIG.nextPreview}</p>
        `;
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        logEvent('quiz_submitted', { score, time_sec: timeOnTask, mastery, attempts });
        if (mastery) logEvent('mastery_achieved', {});

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const savedRole = localStorage.getItem('user_role') || 'student';
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        const roleBadge = document.querySelector('.role-badge');
        roleBadge.textContent = savedRole === 'instructor' ? 'Instructor View' : 'Student View';

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved} (${savedRole})</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
            logEvent('lesson_start', {});
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `
              <button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>
              <div style="margin-top:1rem; font-size:0.9rem;">
                <label>
                  <input type="checkbox" id="teacher-mode"> 
                  I'm an instructor (analytics auto-enabled to improve lessons)
                </label>
              </div>
            `;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                const isTeacher = document.getElementById('teacher-mode').checked;
                localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
                if (isTeacher) enableAnalytics();
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
                roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
                logEvent('lesson_start', {});
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `
            <button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>
            <div style="margin-top:1rem; font-size:0.9rem;">
              <label>
                <input type="checkbox" id="teacher-mode"> 
                I'm an instructor (analytics auto-enabled to improve lessons)
              </label>
            </div>
          `;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              const isTeacher = document.getElementById('teacher-mode').checked;
              localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
              if (isTeacher) enableAnalytics();
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
              roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
              logEvent('lesson_start', {});
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        renderContent();
        renderNavigation();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('send-analytics').onclick = (e) => {
          e.preventDefault();
          if (confirm('Send anonymous usage data to help improve Mini OpenStax?')) {
            sendAnalyticsEvents();
          }
        };
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
