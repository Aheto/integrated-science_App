<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: From Clean Communities to Healthy Lives ‚Äî The Science of Well-being">
  <title>Mini OpenStax ‚Äî From Clean Communities to Healthy Lives</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
    .activity-card, .review-card {
      background: #f8f9fa;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 6px;
      border-left: 4px solid var(--green);
    }
  </style>
</head>
<body>
  <div class="container">
    <divBased on the **NaCCA Science Curriculum** and your uploaded files:

- **Strand 5: Humans and the Environment**  
  - **Sub-strand 1**: *Waste Management* (Lessons 52‚Äì53)  
  - **Sub-strand 2**: *Human Health* (Lessons 55‚Äì56, per `lesson 55 -56.pdf`)

There is **no explicit Lesson 54** in the curriculum. However, following your established pattern‚Äîjust as **Chapter 31** bridged *Energy ‚Üí Electricity*, **Chapter 37** bridged *Electricity ‚Üí Conservation*, **Chapter 41** bridged *Conservation ‚Üí Force and Motion*, **Chapter 49** bridged *Force and Motion ‚Üí Agricultural Tools*, and **Chapter 52** bridged *Agricultural Tools ‚Üí Waste Management*‚Äî**Chapter 54** logically serves as a **transition lesson** between *Waste Management* (Lessons 52‚Äì53) and *Human Health* (Lessons 55‚Äì56).

This bridge should:
- Connect **environmental cleanliness** to **human health**
- Introduce the idea that **poor waste management leads to disease**
- Preview **deficiency and viral diseases** as public health challenges
- Set up the core question: *‚ÄúHow do our environment and diet affect our health‚Äîand how can science help us stay well?‚Äù*

Thus, **Chapter 54** is titled:  
> **‚ÄúFrom Clean Communities to Healthy Lives: The Science of Well-being‚Äù**

Below is a complete, standards-aligned, Vanilla JS/HTML file that fulfills this role‚Äîconsistent with your Mini OpenStax style, NaCCA exemplars, and your learning preferences.

---

### ‚úÖ `chapter-54.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: From Clean Communities to Healthy Lives ‚Äî The Science of Well-being">
  <title>Mini OpenStax ‚Äî From Clean Communities to Healthy Lives</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
    .activity-card, .review-card {
      background: #f8f9fa;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 6px;
      border-left: 4px solid var(--green);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">From Clean Communities to Healthy Lives</h1>
        <div class="lo-tags" id="lo-tags">B7/JHS1.5.1 ‚Üí B7/JHS1.5.2</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <div class="section">
        <h2>üéØ What You‚Äôll Learn</h2>
        <ul id="objectives">
          <!-- Filled by JS -->
        </ul>
      </div>

      <div class="section">
        <h2>üî§ Important Words</h2>
        <p id="word-list-desc">Key terms for this lesson:</p>
        <div class="word-list" id="word-list">
          <!-- Filled by JS -->
        </div>
      </div>

      <div class="section" id="lesson-content">
        <h2>üìò Clean Environment = Healthy People</h2>
        <p>You‚Äôve learned to manage waste scientifically. But why does it matter for **your health**?</p>
        <p>The answer is clear: **unclean environments breed disease**, while **good nutrition and hygiene prevent illness**. Science connects clean streets to strong bodies!</p>

        <table>
          <thead>
            <tr><th>Environmental Condition</th><th>Health Risk</th><th>Scientific Prevention</th></tr>
          </thead>
          <tbody>
            <tr><td>Stagnant water + plastic waste</td><td>Mosquitoes ‚Üí Malaria</td><td>Drain standing water, cover containers</td></tr>
            <tr><td>Open defecation / poor sanitation</td><td>Cholera, dysentery</td><td>Use toilets, wash hands with soap</td></tr>
            <tr><td>Food waste attracting flies</td><td>Diarrhea, typhoid</td><td>Cover food, compost organics</td></tr>
            <tr><td>Poor diet (no vegetables, meat)</td><td>Kwashiorkor, anemia, scurvy</td><td>Eat balanced meals with local foods</td></tr>
          </tbody>
        </table>

        <blockquote>
          üí≠ <strong>Thought Experiment</strong>: If a community cleans its drains, covers food, and eats yam, groundnuts, and leafy greens daily, how would child sickness rates change? What role does science play in this transformation?
        </blockquote>

        <div class="review-card">
          <h3>‚úÖ Strand 5 Review: Quick Recall</h3>
          <ul>
            <li>Waste must be sorted: organic ‚Üí compost, recyclable ‚Üí reuse, hazardous ‚Üí safe disposal.</li>
            <li>The 5 R‚Äôs: Refuse, Reduce, Reuse, Recycle, Rot.</li>
            <li>Clean environments prevent disease and honor cultural values.</li>
            <li>Now, we extend care from the environment to the human body.</li>
          </ul>
        </div>

        <div class="activity-card">
          <h3>‚úÖ Bridge Activity</h3>
          <p><strong>‚ÄúHealth & Environment Connection Map‚Äù</strong><br>
          In groups:<br>
          1. Draw two circles: ‚ÄúClean Environment‚Äù and ‚ÄúHealthy Body.‚Äù<br>
          2. Use arrows to connect:<br>
             ‚Äì Waste practices ‚Üí disease risks<br>
             ‚Äì Food choices ‚Üí nutrient benefits<br>
          3. Add real examples from your community.<br>
          4. Present your map with explanations.<br>
          Example: ‚ÄúNo composting ‚Üí flies on food ‚Üí stomach pain.‚Äù
        </div>
      </div>

      <div class="section">
        <h2>‚úÖ Check Your Understanding</h2>
        <div class="checkpoint" id="checkpoint-questions">
          <!-- Filled by JS -->
        </div>
      </div>

      <div class="section" id="next-preview">
        <h3>üîú Coming Up</h3>
        <p>In Lesson 55, you‚Äôll explore deficiency diseases like kwashiorkor and scurvy‚Äîand learn how eating local, balanced meals keeps you strong!</p>
      </div>

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>

      <footer>
        <a href="../premium.html" style="display:block; margin-bottom:0.5rem;">‚ú® Unlock Premium Features</a>
        <a href="#" id="send-analytics" style="color:#6c757d;">üì§ Send Anonymous Usage Data</a>
        <br>
        <a href="../dashboard.html">üìä View Dashboard</a>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      const currentChapter = 54;
      const MAX_CHAPTER = 300;
      const WHATSAPP_NUMBER = "233257320201";

      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      const ANALYTICS_KEY = 'miniopenstax_analytics_consent';
      const EVENTS_KEY = 'miniopenstax_events';

      function isAnalyticsEnabled() {
        return localStorage.getItem(ANALYTICS_KEY) === '1';
      }

      function logEvent(eventType, data = {}) {
        if (!isAnalyticsEnabled()) return;
        const event = { type: eventType, timestamp: Date.now(), lesson: currentChapter, data };
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        events.push(event);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        if (events.length >= 20) sendAnalyticsEvents();
      }

      function enableAnalytics() {
        localStorage.setItem(ANALYTICS_KEY, '1');
      }

      function sendAnalyticsEvents() {
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        if (events.length === 0) return;
        const summary = {
          lessons_attempted: [...new Set(events.map(e => e.lesson))].length,
          quizzes_submitted: events.filter(e => e.type === 'quiz_submitted').length,
          mastery_count: events.filter(e => e.type === 'mastery_achieved').length,
          first_event: new Date(events[0].timestamp).toISOString().split('T')[0],
          last_event: new Date(events[events.length - 1].timestamp).toISOString().split('T')[0]
        };
        const report = `*Mini OpenStax ‚Äî Anonymous Usage Report*\n` +
          `Lessons Tried: ${summary.lessons_attempted}\n` +
          `Quizzes Taken: ${summary.quizzes_submitted}\n` +
          `Mastery Achieved: ${summary.mastery_count}\n` +
          `Period: ${summary.first_event} to ${summary.last_event}\n\n` +
          `Thank you for helping improve literacy tools!`;
        localStorage.removeItem(EVENTS_KEY);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        window.open(url, '_blank');
      }

      const CHAPTER_CONFIG = {
        title: "From Clean Communities to Healthy Lives",
        loTags: ["B7/JHS1.5.1 ‚Üí B7/JHS1.5.2"],
        objectives: [
          "Explain how poor waste management leads to disease.",
          "Connect environmental cleanliness to nutritional health.",
          "Identify common health risks linked to sanitation and diet.",
          "Prepare for studying deficiency and viral diseases in Lessons 55‚Äì56."
        ],
        words: [
          "Sanitation", "Nutrition", "Deficiency", "Disease", "Hygiene",
          "Malaria", "Cholera", "Kwashiorkor", "Prevention", "Well-being"
        ],
        wordListDesc: "Key terms for this lesson:",
        checkpointQuestions: `
          <ol>
            <li>How does stagnant water near plastic waste cause malaria?</li>
            <li>Why does open defecation lead to cholera?</li>
            <li>Name three local Ghanaian foods that prevent deficiency diseases.</li>
            <li>How does scientific waste management support public health?</li>
          </ol>
          <p><em>Reflect before exploring deficiency diseases!</em></p>
        `,
        nextPreview: "In Lesson 55, you‚Äôll explore deficiency diseases like kwashiorkor and scurvy‚Äîand learn how eating local, balanced meals keeps you strong!",
        assessmentItems: [
          { id: "1", prompt: "Poor sanitation can cause:", options: [
            {id:"a",text:"Better crops",is_correct:false},
            {id:"b",text:"Cholera and dysentery",is_correct:true},
            {id:"c",text:"Clean air",is_correct:false},
            {id:"d",text:"More rain",is_correct:false}
          ]},
          { id: "2", prompt: "Stagnant water breeds:", options: [
            {id:"a",text:"Fish",is_correct:false},
            {id:"b",text:"Mosquitoes",is_correct:true},
            {id:"c",text:"Plants",is_correct:false},
            {id:"d",text:"Birds",is_correct:false}
          ]},
          { id: "3", prompt: "Kwashiorkor is caused by lack of:", options: [
            {id:"a",text:"Carbohydrates",is_correct:false},
            {id:"b",text:"Protein",is_correct:true},
            {id:"c",text:"Fat",is_correct:false},
            {id:"d",text:"Water",is_correct:false}
          ]},
          { id: "4", prompt: "Anemia is often due to lack of:", options: [
            {id:"a",text:"Vitamin C",is_correct:false},
            {id:"b",text:"Iron",is_correct:true},
            {id:"c",text:"Sugar",is_correct:false},
            {id:"d",text:"Salt",is_correct:false}
          ]},
          { id: "5", prompt: "Scurvy results from lack of:", options: [
            {id:"a",text:"Vitamin A",is_correct:false},
            {id:"b",text:"Vitamin C",is_correct:true},
            {id:"c",text:"Calcium",is_correct:false},
            {id:"d",text:"Protein",is_correct:false}
          ]},
          { id: "6", prompt: "Covering food prevents:", options: [
            {id:"a",text:"Flies and contamination",is_correct:true},
            {id:"b",text:"Growth",is_correct:false},
            {id:"c",text:"Cooking",is_correct:false},
            {id:"d",text:"Taste",is_correct:false}
          ]},
          { id: "7", prompt: "Handwashing with soap reduces:", options: [
            {id:"a",text:"Diarrhea and typhoid",is_correct:true},
            {id:"b",text:"Rainfall",is_correct:false},
            {id:"c",text:"Crop yield",is_correct:false},
            {id:"d",text:"Tool rust",is_correct:false}
          ]},
          { id: "8", prompt: "Groundnuts are rich in:", options: [
            {id:"a",text:"Only fat",is_correct:false},
            {id:"b",text:"Protein and healthy fats",is_correct:true},
            {id:"c",text:"Sugar",is_correct:false},
            {id:"d",text:"Water",is_correct:false}
          ]},
          { id: "9", prompt: "Leafy greens like kontomire provide:", options: [
            {id:"a",text:"Iron and vitamins",is_correct:true},
            {id:"b",text:"Only water",is_correct:false},
            {id:"c",text:"Plastic",is_correct:false},
            {id:"d",text:"Metal",is_correct:false}
          ]},
          { id: "10", prompt: "Science links environment and health by:", options: [
            {id:"a",text:"Showing cause-effect relationships",is_correct:true},
            {id:"b",text:"Ignoring connections",is_correct:false},
            {id:"c",text:"Promoting littering",is_correct:false},
            {id:"d",text:"Avoiding action",is_correct:false}
          ]},
          { id: "11", prompt: "Rickets is caused by lack of:", options: [
            {id:"a",text:"Vitamin D and calcium",is_correct:true},
            {id:"b",text:"Sugar",is_correct:false},
            {id:"c",text:"Fat",is_correct:false},
            {id:"d",text:"Salt",is_correct:false}
          ]},
          { id: "12", prompt: "Night blindness is due to lack of:", options: [
            {id:"a",text:"Vitamin A",is_correct:true},
            {id:"b",text:"Vitamin B",is_correct:false},
            {id:"c",text:"Iron",is_correct:false},
            {id:"d",text:"Protein",is_correct:false}
          ]},
          { id: "13", prompt: "Balanced diet includes:", options: [
            {id:"a",text:"Only rice",is_correct:false},
            {id:"b",text:"Carbs, protein, fats, vitamins, minerals",is_correct:true},
            {id:"c",text:"Only sweets",is_correct:false},
            {id:"d",text:"Only water",is_correct:false}
          ]},
          { id: "14", prompt: "Clean drains help prevent:", options: [
            {id:"a",text:"Malaria",is_correct:true},
            {id:"b",text:"Earthquakes",is_correct:false},
            {id:"c",text:"Tool rust",is_correct:false},
            {id:"d",text:"Noise",is_correct:false}
          ]},
          { id: "15", prompt: "Public health means:", options: [
            {id:"a",text:"Only hospital care",is_correct:false},
            {id:"b",text:"Community-wide prevention and wellness",is_correct:true},
            {id:"c",text:"Ignoring environment",is_correct:false},
            {id:"d",text:"Only rich people",is_correct:false}
          ]},
          { id: "16", prompt: "Local foods support health because they:", options: [
            {id:"a",text:"Are fresh, affordable, and nutrient-rich",is_correct:true},
            {id:"b",text:"Are always processed",is_correct:false},
            {id:"c",text:"Cost more",is_correct:false},
            {id:"d",text:"Have no nutrients",is_correct:false}
          ]},
          { id: "17", prompt: "Cultural identity includes:", options: [
            {id:"a",text:"Eating traditional, healthy meals",is_correct:true},
            {id:"b",text:"Discarding all customs",is_correct:false},
            {id:"c",text:"Only imported foods",is_correct:false},
            {id:"d",text:"Ignoring elders",is_correct:false}
          ]},
          { id: "18", prompt: "Students can promote health by:", options: [
            {id:"a",text:"Teaching peers about nutrition and hygiene",is_correct:true},
            {id:"b",text:"Littering secretly",is_correct:false},
            {id:"c",text:"Avoiding science",is_correct:false},
            {id:"d",text:"Waiting for adults only",is_correct:false}
          ]},
          { id: "19", prompt: "The next lesson focuses on:", options: [
            {id:"a",text:"Deficiency diseases and nutrition",is_correct:true},
            {id:"b",text:"Only electricity",is_correct:false},
            {id:"c",text:"Avoiding science",is_correct:false},
            {id:"d",text:"Nuclear weapons",is_correct:false}
          ]},
          { id: "20", prompt: "This lesson shows that:", options: [
            {id:"a",text:"Clean environment and good food are foundations of health",is_correct:true},
            {id:"b",text:"Health is unrelated to waste",is_correct:false},
            {id:"c",text:"Science stops at the classroom",is_correct:false},
            {id:"d",text:"Disease is unavoidable",is_correct:false}
          ]}
        ]
      };

      function renderContent() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];

        document.getElementById('objectives').innerHTML =
          CHAPTER_CONFIG.objectives.map(obj => `<li>${obj}</li>`).join('');

        document.getElementById('word-list-desc').textContent = CHAPTER_CONFIG.wordListDesc;
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.words.map(w => `<span class="word-item">${w}</span>`).join('');

        document.getElementById('checkpoint-questions').innerHTML = CHAPTER_CONFIG.checkpointQuestions;

        document.getElementById('next-preview').innerHTML = `
          <h3>üîú Coming Up</h3>
          <p>${CHAPTER_CONFIG.nextPreview}</p>
        `;
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        logEvent('quiz_submitted', { score, time_sec: timeOnTask, mastery, attempts });
        if (mastery) logEvent('mastery_achieved', {});

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const savedRole = localStorage.getItem('user_role') || 'student';
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        const roleBadge = document.querySelector('.role-badge');
        roleBadge.textContent = savedRole === 'instructor' ? 'Instructor View' : 'Student View';

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved} (${savedRole})</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
            logEvent('lesson_start', {});
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `
              <button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>
              <div style="margin-top:1rem; font-size:0.9rem;">
                <label>
                  <input type="checkbox" id="teacher-mode"> 
                  I'm an instructor (analytics auto-enabled to improve lessons)
                </label>
              </div>
            `;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                const isTeacher = document.getElementById('teacher-mode').checked;
                localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
                if (isTeacher) enableAnalytics();
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
                roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
                logEvent('lesson_start', {});
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `
            <button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>
            <div style="margin-top:1rem; font-size:0.9rem;">
              <label>
                <input type="checkbox" id="teacher-mode"> 
                I'm an instructor (analytics auto-enabled to improve lessons)
              </label>
            </div>
          `;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              const isTeacher = document.getElementById('teacher-mode').checked;
              localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
              if (isTeacher) enableAnalytics();
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
              roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
              logEvent('lesson_start', {});
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        renderContent();
        renderNavigation();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('send-analytics').onclick = (e) => {
          e.preventDefault();
          if (confirm('Send anonymous usage data to help improve Mini OpenStax?')) {
            sendAnalyticsEvents();
          }
        };
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
